<!--
  é¢„ç®—ä¸­å¿ƒé¡µé¢
  å¯¹åº”åŸ Vue é¡¹ç›®çš„ BudgetCenter.vue
-->
<view class="budget-container">
  <!-- æœ¬æœˆé¢„ç®—æ¦‚è§ˆ -->
  <view class="card overview-card">
    <view class="card-header">
      <text class="card-title">ğŸ’° æœ¬æœˆé¢„ç®—</text>
      <text class="edit-btn" bindtap="showEditModal">ç¼–è¾‘</text>
    </view>
    
    <view class="budget-info">
      <view class="budget-main">
        <text class="budget-label">é¢„ç®—é™é¢</text>
        <text class="budget-value">Â¥{{currentBudget.amount || '0.00'}}</text>
      </view>
      
      <view class="progress-section">
        <view class="progress-header">
          <text class="progress-label">å·²ä½¿ç”¨ Â¥{{usedAmount}}</text>
          <text class="progress-percent {{usagePercent >= 100 ? 'danger' : usagePercent >= 80 ? 'warning' : ''}}">
            {{usagePercent}}%
          </text>
        </view>
        <view class="progress-bar">
          <view 
            class="progress-fill {{usagePercent >= 100 ? 'danger' : usagePercent >= 80 ? 'warning' : ''}}" 
            style="width: {{Math.min(usagePercent, 100)}}%;"
          ></view>
        </view>
        <text class="progress-remain">å‰©ä½™ Â¥{{remainAmount}}</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»é¢„ç®— -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">ğŸ“Š åˆ†ç±»é¢„ç®—</text>
      <text class="add-btn" bindtap="showAddCategory">+ æ·»åŠ </text>
    </view>

    <view class="category-list" wx:if="{{categoryBudgets.length > 0}}">
      <view 
        class="category-item"
        wx:for="{{categoryBudgets}}"
        wx:key="category"
      >
        <view class="category-header">
          <view class="category-left">
            <text class="category-icon">{{item.icon}}</text>
            <text class="category-name">{{item.category}}</text>
          </view>
          <view class="category-right">
            <text class="category-used">Â¥{{item.usedAmount}}</text>
            <text class="category-limit"> / Â¥{{item.limitAmount}}</text>
          </view>
        </view>
        <view class="category-progress">
          <view class="progress-bar small">
            <view 
              class="progress-fill {{item.isOver ? 'danger' : item.percent >= 80 ? 'warning' : ''}}"
              style="width: {{item.percent > 100 ? 100 : item.percent}}%;"
            ></view>
          </view>
          <text class="category-percent {{item.isOver ? 'danger' : ''}}">{{item.percent}}%</text>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <text class="empty-text">æš‚æœªè®¾ç½®åˆ†ç±»é¢„ç®—</text>
    </view>
  </view>

  <!-- å†å²é¢„ç®— -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">ğŸ“… å†å²é¢„ç®—</text>
    </view>

    <view class="history-list" wx:if="{{historyBudgets.length > 0}}">
      <view 
        class="history-item"
        wx:for="{{historyBudgets}}"
        wx:key="month"
      >
        <text class="history-month">{{item.month}}</text>
        <view class="history-info">
          <text class="history-budget">é¢„ç®— Â¥{{item.amount}}</text>
          <text class="history-used">æ”¯å‡º Â¥{{item.used}}</text>
        </view>
        <view class="tag {{item.status === 'over' ? 'tag-danger' : 'tag-success'}}">
          <text>{{item.status === 'over' ? 'è¶…æ”¯' : 'æ­£å¸¸'}}</text>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
    </view>
  </view>
</view>

<!-- ç¼–è¾‘å¼¹çª— -->
<view class="modal-mask" wx:if="{{showModal}}" bindtap="hideModal"></view>
<view class="modal {{showModal ? 'show' : ''}}">
  <view class="modal-header">
    <text class="modal-title">è®¾ç½®åˆ†ç±»é¢„ç®—</text>
    <text class="modal-close" bindtap="hideModal">Ã—</text>
  </view>
  <view class="modal-body">
    <view class="form-item">
      <text class="form-label">æ¶ˆè´¹åˆ†ç±»</text>
      <view class="form-input disabled">{{editCategory || 'è¯·å…ˆé€‰æ‹©åˆ†ç±»'}}</view>
    </view>
    <view class="form-item">
      <text class="form-label">é¢„ç®—é‡‘é¢ (å…ƒ)</text>
      <input 
        class="form-input"
        type="digit"
        placeholder="è¯·è¾“å…¥é¢„ç®—é‡‘é¢"
        value="{{editAmount}}"
        bindinput="onAmountInput"
      />
    </view>
  </view>
  <view class="modal-footer">
    <button class="btn btn-default" bindtap="hideModal">å–æ¶ˆ</button>
    <button class="btn btn-primary" bindtap="saveBudget">ä¿å­˜</button>
  </view>
</view>
