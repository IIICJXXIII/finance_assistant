<!--
  å½’æ¡£è®°å½•åˆ—è¡¨é¡µé¢
  å¯¹åº”åŸ Vue é¡¹ç›®çš„ DocList.vue
-->
<view class="list-container">
  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-bar">
      <image class="search-icon" src="/assets/icons/search.png" mode="aspectFit" />
      <input 
        class="search-input"
        placeholder="æœç´¢å•†æˆ·/é¡¹ç›®..."
        value="{{keyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="handleSearch"
      />
      <image 
        wx:if="{{keyword}}"
        class="clear-icon" 
        src="/assets/icons/close.png" 
        mode="aspectFit"
        bindtap="clearSearch"
      />
    </view>
    
    <!-- åˆ†ç±»ç­›é€‰ -->
    <scroll-view class="filter-scroll" scroll-x enable-flex>
      <view 
        class="filter-item {{currentCategory === '' ? 'active' : ''}}"
        bindtap="onCategoryFilter"
        data-category=""
      >
        å…¨éƒ¨
      </view>
      <view 
        class="filter-item {{currentCategory === item ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="*this"
        bindtap="onCategoryFilter"
        data-category="{{item}}"
      >
        {{item}}
      </view>
    </scroll-view>
  </view>

  <!-- åˆ—è¡¨åŒºåŸŸ -->
  <view class="list-section">
    <!-- å·¥å…·æ  -->
    <view class="toolbar">
      <text class="list-title">ğŸ§¾ å½’æ¡£è®°å½•</text>
      <view class="tag tag-info">
        <text>å…± {{total}} æ¡</text>
      </view>
    </view>

    <!-- åˆ—è¡¨ -->
    <scroll-view 
      class="list-scroll" 
      scroll-y
      refresher-enabled
      refresher-triggered="{{refreshing}}"
      bindrefresherrefresh="onRefresh"
      bindscrolltolower="onLoadMore"
    >
      <block wx:if="{{list.length > 0}}">
        <view 
          class="list-item card"
          wx:for="{{list}}"
          wx:key="id"
          bindtap="viewDetail"
          data-item="{{item}}"
        >
          <view class="item-main">
            <view class="item-header">
              <text class="merchant-name ellipsis">{{item.merchantName}}</text>
              <text class="amount">Â¥{{item.amountStr}}</text>
            </view>
            <view class="item-info">
              <text class="item-name ellipsis">{{item.itemName || '-'}}</text>
            </view>
            <view class="item-footer">
              <view class="footer-left">
                <view class="tag {{item.categoryClass}}">
                  <text>{{item.category}}</text>
                </view>
                <text class="date">{{item.date}}</text>
              </view>
              <view class="status-tag {{item.statusClass}}">
                <text>{{item.statusText}}</text>
              </view>
            </view>
          </view>
          
          <!-- å¼‚å¸¸æ ‡è¯† -->
          <view class="anomaly-badge" wx:if="{{item.isAnomaly === 1}}">
            <text>âš ï¸</text>
          </view>
        </view>
      </block>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:elif="{{!loading}}" class="empty-state">
        <text class="empty-icon">ğŸ“‹</text>
        <text class="empty-text">æš‚æ— å½’æ¡£è®°å½•</text>
        <button class="btn btn-primary" style="margin-top: 30rpx; width: 240rpx;" bindtap="goToUpload">
          ç«‹å³å½’æ¡£
        </button>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{list.length > 0}}">
        <text wx:if="{{loadingMore}}">åŠ è½½ä¸­...</text>
        <text wx:elif="{{noMore}}">â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
      </view>
    </scroll-view>
  </view>

  <!-- æ“ä½œå¼¹çª— -->
  <view class="action-sheet-mask" wx:if="{{showActions}}" bindtap="hideActions"></view>
  <view class="action-sheet {{showActions ? 'show' : ''}}">
    <view class="action-header">
      <text class="action-title">{{currentItem.merchantName}}</text>
      <text class="action-amount">Â¥{{currentItem.amountStr}}</text>
    </view>
    <view class="action-list">
      <view class="action-item" bindtap="submitApproval" wx:if="{{currentItem.status === 0}}">
        <text class="action-icon">ğŸ“¤</text>
        <text>æäº¤å®¡æ‰¹</text>
      </view>
      <view class="action-item" bindtap="editItem" wx:if="{{currentItem.status === 0 || currentItem.status === 3}}">
        <text class="action-icon">âœï¸</text>
        <text>ç¼–è¾‘</text>
      </view>
      <view class="action-item danger" bindtap="deleteItem">
        <text class="action-icon">ğŸ—‘ï¸</text>
        <text>åˆ é™¤</text>
      </view>
    </view>
    <view class="action-cancel" bindtap="hideActions">å–æ¶ˆ</view>
  </view>
</view>
